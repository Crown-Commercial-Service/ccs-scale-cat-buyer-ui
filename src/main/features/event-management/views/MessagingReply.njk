{% extends "template.njk" %}
{% from "macros/csrf.njk" import csrfProtection %}
{% from "components/support/macro.njk" import howToGetSupport %}

{% set title = 'Message Reply ' %}

{% set sortedMembers = [
  {
    value: "",
    text: "Please select"
  }
] %}
{% block breadCrumb %}
  {{ CCSBreadcrumbs({
        items:[
    {
      "text": "[Dashboard]",
      "href": "/dashboard"
    },
    {
      "text": eventId+" / "+eventType,
      "href": "/event/management?id="+eventId
    },
    
    {
      "text": "Supplier Message",
      "href": "#"
    }
  ]
    }) }}
{% endblock %}

{% for msg in message.create_message %}
  {% if selected_message == msg %}
    {% set sortedMembers = (sortedMembers.push({value: msg, text: msg, selected: msg}), sortedMembers) %}
  {% else %}
    {% set sortedMembers = (sortedMembers.push({value: msg, text: msg}), sortedMembers) %}
  {% endif %}
{% endfor %}

{% block content %}
  <main class="govuk-main-wrapper govuk-main-wrapper--auto-spacing" id="main-content" role="main">

    {% if (validationError) %}

      {{ CCSErrorSummary({
  titleText: "Broadcast cannot be completed",
  errorList: errorText
}) }}
    {%endif %}
    <div class="govuk-grid-row govuk-!-padding-bottom-7">
      <div class="govuk-grid-column-full">
        <h1 class="govuk-heading-xl">
         <strong> {{data.title}} </strong>
        </h1>
        <p class="govuk-body">
          <strong>Event Id / Name : {{eventId | upper}} / {{eventType}}</strong>
        </p>
      <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">
              <div class="project-overview">
        <p class="govuk-body">Selected agreement: <strong>{{ agreement_header['agreementName'] }}{% if(agreement_header.agreementLotName !== undefined)%}, {% if agreement_header['lotid'] !== undefined %}  {% endif %} {{ agreement_header['lotid'] }}: {{ agreement_header['agreementLotName'] }}  
  </strong></p>
  {%endif %}
  <p class="govuk-body">Agreement ID: <strong>{{ agreement_header['agreementId_session'] }}</strong></p>
        </div>
      </div>  
</div>
      </div>
    </div>

    <div class="govuk-grid-row messaging-navigation">
      <div class="govuk-grid-column-full">
        <nav class="global-navigation" data-toggle="nav" data-app-uri="http://www.crowncommercial.gov.uk/" data-app-pathinfo="/">

            <ul class="nav-list messaging-nav-list--primary">
                        <li class="nav-list__item">
                            <a class="nav-list__link " href="{{data.tabs.href1}}?type=create">{{data.tabs.text1}}</a>
                        </li>
                        <li class="nav-list__item selected">
                            {{data.tabs.text2}}
                        </li>
                        <li class="nav-list__item">
                            <a class="nav-list__link " href="{{data.tabs.href3}}?type=sent">{{data.tabs.text3}}</a>
                        </li>
                    </ul>
        </nav>
      </div>
    </div>
    <form id="ccs_message_reply_form" name="ccs_message_reply_form" action="/message/reply" method="POST">
      {{ csrfProtection(csrf) }}
     
      <div class="govuk-grid-row govuk-!-margin-bottom-6 govuk-!-margin-top-6 ccs-page-section">
        <div class="govuk-grid-column-full">
          <div class="govuk-grid-column-two-thirds">
          <a href="{{data.backlink}}">Back</a></br></br></br>
              {%if msgThreadList.length >0%}
         <span class="govuk-label govuk-label govuk-label--m">Message thread</span></br>
        
          <details class="govuk-details" data-module="govuk-details">
           {%for msgItem in msgThreadList%}
           {%if loop.index ===1%}
            <summary class="govuk-details__summary">
              <span class="govuk-details__summary-text">
                Subject: {{msgItem.OCDS.title}}
              </span>
            </summary>
            {%else%}
            <div class="govuk-details__text_message">
             <span>
                Subject: {{msgItem.OCDS.title}}
              </span>
            </div>
            
            {%endif%}
            <div class="govuk-details__text_message">
             <span>
                Date: {{msgItem.OCDS.date | dateddmmyyyy}}
              </span>
            </div>
            <div class="govuk-details__text_message">
              <span>
               Message: {{msgItem.OCDS.description}}
              </span>
            </div>
            <div class="govuk-details__text_message_bottom"></div>
            {% endfor %}
        </details>
         
        {%endif%}
       <label class="govuk-label govuk-label govuk-label--m">{{data.line1}} {{message.OCDS.author.name}}</label></br>
         
<p class="govuk-body">{{data.MessageClassification}} : <strong>{{message.nonOCDS.classification}}</strong></p></br>
              {{ CCSInput({           
                id: "reply_subject_input",
                name: "reply_subject_input",
                value: "RE: "+message.OCDS.title,
                maxlength:500,
                label: {
                  text: data.Subject
                }
                })
              }}
            <p><label id="reply_message_input_textbox_count"></label></p>

            <div class="govuk-character-count" data-module="govuk-character-count" data-maxlength="200">
             <span>Your message:</span>
             <textarea class="govuk-textarea govuk-js-character-count" id="reply_message_input" name="reply_message_input" rows="5"  ></textarea>
                 <p><label id="reply_message_input_textarea_count"></label></p>
              </div>

            <div class="govuk-button-group">
              {{ CCSButton({
                text: data.btnText,
                action:"submit"
                })
            }}
              <a href="{{data.Cancel.link}}" class="govuk-link govuk-link--no-visited-state">{{data.Cancel.text}}</a>
            </div>

          </div>
        </div>
      </div>
    </form>
  
  </main>
{% endblock %}