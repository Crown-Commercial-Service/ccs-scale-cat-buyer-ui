{% extends "template.njk" %}
{% from "macros/csrf.njk" import csrfProtection %}
{% from "components/support/macro.njk" import howToGetSupport %}

{% set title = 'Supplier message ' %}
{% block breadCrumb %}
  {{ CCSBreadcrumbs({
        items:[
    {
      "text": "Dashboard",
      "href": "/dashboard"
    },
    {
      "text": eventId+" / "+eventType,
      "href": "/event/management?id="+eventId
    },
     
    {
      "text": "Supplier Message",
      "href": "#"
    }
  ]
    }) }}
{% endblock %}
{% block content %}
  <main class="govuk-main-wrapper govuk-main-wrapper--auto-spacing" id="main-content" role="main">
    {% if (error) %}
      {{ CCSErrorSummary({
    titleText: "There is a problem",
    errorList: [
        {
        text: "Please select an option"
        }
    ]
    }) }}
    {%endif %}
    
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">
        <h1 class="govuk-heading-xl">
          <strong>Message</strong>
        </h1>
        <p class="govuk-body">
          <strong>Event Id / Name : {{eventId | upper}} / {{eventType}}</strong>
        </p>
       <p class="govuk-body">Selected agreement: {{ agreement_header['agreementName'] }}{% if(agreement_header.agreementLotName !== undefined)%}, {% if agreement_header['lotid'] !== undefined %} {% endif %} {{ agreement_header['lotid'] }}: {{ agreement_header['agreementLotName'] }}  
  </p>
  {%endif %}
  <p class="govuk-body">Agreement ID: {{ agreement_header['agreementId_session'] }}</p>
      </div>
    </div></br></br>
    <div class="govuk-grid-row ccs-page-section">
      <div class="govuk-grid-column-full">
        <p>
          {{data.subtitle}}
          <ul>
        <li>{{data.subtitleLine1}}</li>
        <li>{{data.subtitleLine2}}</li>
        <li>{{data.subtitleLine3}}</li>
        </ul>
        </p>
        <div>
          <div class="govuk-grid-row messaging-navigation">
            <div class="govuk-grid-column-full">
              <nav class="global-navigation" data-toggle="nav" data-app-uri="http://www.crowncommercial.gov.uk/" data-app-pathinfo="/">

                <ul class="nav-list messaging-nav-list--primary">
                  <li class="nav-list__item">
                    <a class="nav-list__link" href="{{data.tabs.href1}}?type=create">{{data.tabs.text1}}</a>
                  </li>
                  {%if(type==='received')%}
                  <li class="nav-list__item selected">
                    <a class="nav-list__link" href="{{data.tabs.href2}}?type=received">{{data.tabs.text2}}</a>
                  </li>
                  {%else%}
                   <li class="nav-list__item">
                    <a class="nav-list__link" href="{{data.tabs.href2}}?type=received">{{data.tabs.text2}}</a>
                  </li>
                  {%endif%}
                  {%if(type==='sent')%}
                  <li class="nav-list__item selected">
                    <a class="nav-list__link " href="{{data.tabs.href3}}?type=sent">{{data.tabs.text3}}</a>
                  </li>
                  {%else%}
                    <li class="nav-list__item">
                      <a class="nav-list__link " href="{{data.tabs.href3}}?type=sent">{{data.tabs.text3}}</a>
                    </li>
                  {%endif%}
                  
                </ul>
              </nav>
            </div>
          </div>
          <form id="event_supplier_message_form" name="event_supplier_message_form" class="form event_supplier_message_form" action="/message/details" method="POST">
            {{ csrfProtection(csrf) }}
            {%if(type==='received')%}
            <a href="{{data.backlink}}">back</a></br></br></br>
            {%else%}
            <a href="/message/sent?type=sent">back</a></br></br></br>
            {%endif%}
            <label class="govuk-label govuk-label govuk-label--m">{{messageDetails.OCDS.title}}</label>
            <label class="govuk-label govuk-label govuk-label--m">{{data.line4}}{{messageDetails.OCDS.author.name}}</label>
            <p class="govuk-body">{{data.line1}} : {{messageDetails.nonOCDS.classification}}</p>
            <p class="govuk-body">{{data.line2}} : {{messageDetails.OCDS.date | dateddmmyyyy}}</p>
            <p class="govuk-body">
              {% for attachemnt in messageDetails.nonOCDS.attachments%}
                <a class="nav-list__link " href="/message/details?attachmentId={{attachemnt.id}}&id={{id}}">{{attachemnt.name}}</a>
              {% endfor %}
            </p>
            <p class="govuk-body">{{messageDetails.OCDS.description }}</p>
            {% if(type !="sent")%}
            <div class="govuk-button-group">
              {{ CCSButton({
                text: "Reply",
                attributes: {
                id: "ccs_reply_to_supplier"
                },
                classes: "close-event",
                href: "/message/Reply"
                }) }}
               
              <a href="/message/replytoall" class="govuk-link govuk-link--no-visited-state">{{data.backJump3.title}}</a>
              <a href="{{data.backJump.href}}?id={{messageDetails.OCDS.id}}" class="govuk-link govuk-link--no-visited-state">{{data.backJump.title}}</a>
            </div>
            {%endif%}
          </form>
        </div>
      </div>
    </div>
        <p>
            <a href="{{data.backJump2.href}}" class="govuk-link govuk-link--no-visited-state">{{data.backJump2.title}}</a>
            </p>
  </main>
{% endblock %}