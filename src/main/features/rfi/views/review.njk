{% extends "template.njk" %}
{% from "macros/csrf.njk" import csrfProtection %}
{% set title = 'RFI review | Crown Commercial Service' %}

{% block breadCrumb %}
  {{ CCSBreadcrumbs({
        items: data.breadCrumbs
      }) }}
{% endblock %}

{% block content %}
  <main class="govuk-main-wrapper govuk-main-wrapper--auto-spacing" id="main-content" role="main">

    {% if (viewError == true) and (apiError == false) %}
      {{ CCSErrorSummary({
        titleText: "There is a problem with publishing RFI",
        errorList: [
          {
            text: "You must check this box to confirm that I have read and confirm the statements above",
            href: "#ccs_rfi_publish_form"
          }
        ]
      }) }}
    {% endif %}

    {% if (viewError == true) and (apiError == true) %}
      {{ CCSErrorSummary({
        titleText: "There has been an error publishing your RfI",
        errorList: [
          {
            text: "Please try again or contact the CCS helpdesk",
            href: "#ccs_rfi_publish_form"
          }
        ]
      }) }}
    {% endif %}

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">
        <h1 class="govuk-heading-xl">
         <strong> {{data.title }} </strong>
        </h1>
      </div>
    </div>

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full govuk-grid-column-two-thirds-from-desktop">
        {% include "includes/project_header.njk" %}

        <p class="govuk-body">{{data.subtitle}}
        </p>
        {{ CCSButton({
    text: "Download your RfI (.ODT format)",
    classes: "govuk-button--secondary",
    href: "/rfi/review?download=1"
    }) }}

      </div>
    </div>

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full"></div>
    </div>

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">
        <h2 class="govuk-heading-m">1. Project and colleagues</h2>

<dl class="govuk-summary-list">
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
        </dt>
              <dd class="govuk-summary-list__value">
              </dd>
            <dd class="govuk-summary-list__actions">
              
            </dd>
          </div>
      <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
          Name your project
        </dt>
            {% if project_name | length > 0 %}
              <dd class="govuk-summary-list__value">
                <p class="govuk-body-s">
                  {{ project_name | safe }}
                </p>
              </dd>
            {% else %}
              <dd class="govuk-summary-list__value">
          You have not given a custom name to your project
        </dd>
            {% endif %}

            <dd class="govuk-summary-list__actions">
              {% if eventStatus != "published"%}
                <a class="govuk-link" href="/rfi/name-your-project">
            Change<span class="govuk-visually-hidden">project name</span>
                </a>
              {% endif %}
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
          Change who is going to lead the procurement
        </dt>
            <dd class="govuk-summary-list__value">
              <ul class="govuk-list govuk-list--none">
                <li>
                  <span class="govuk-body-s">{{procurementLead.name }}</span></li>
                <li>
                  <span class="govuk-body-s">{{procurementLead.email }}</span></li>
                <li>
                  <span class="govuk-body-s">{{procurementLead.telephone }}</span></li>
              </ul>
            </dd>
            <dd class="govuk-summary-list__actions">
              {% if eventStatus != "published"%}
                <a class="govuk-link" href="/rfi/procurement-lead">
            Change<span class="govuk-visually-hidden"> procurement lead</span>
                </a>
              {% endif %}
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
          Add colleagues to your project
        </dt>
            {% if procurementColleagues | length > 0 %}
              <dd class="govuk-summary-list__value">
                <ul class="govuk-list govuk-list--none">
                  {% for collaborator in procurementColleagues %}
                    <li>
                      <ul class="govuk-list govuk-list--none">
                        <li>
                          <span class="govuk-body-s">{{collaborator.name}}</span></li>
                        <li>
                          <span class="govuk-body-s">{{collaborator.email}}</span></li>
                        <li>
                          <span class="govuk-body-s">{{collaborator.telephone}}</span></li>
                      </ul>
                    </li>
                  {%- endfor %}
                </ul>
              </dd>
            {% else %}
              <dd class="govuk-summary-list__value">
          You have not added anyone so far in your team
        </dd>
            {% endif %}
            <dd class="govuk-summary-list__actions">
              {% if eventStatus != "published"%}
                <a class="govuk-link" href="/rfi/add-collaborators">
            Change<span class="govuk-visually-hidden"> rfi team members</span>
                </a>
              {% endif %}
            </dd>
          </div>
        </dl>

        <h2 class="govuk-heading-m">2. Build your RfI </h2>
        <dl class="govuk-summary-list">

<div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
        </dt>
              <dd class="govuk-summary-list__value">
              </dd>
            <dd class="govuk-summary-list__actions">
              
            </dd>
          </div>

          <!--<div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
          Choose how to build your RfI
        </dt>
            {% if ccs_rfi_type == 'all_online' %}
              <dd class="govuk-summary-list__value">
          Provide all information online
        </dd>
            {% else %}
              <dd class="govuk-summary-list__value">
          Complete a document offline
        </dd>
            {% endif %}

            <dd class="govuk-summary-list__actions">
              {% if eventStatus != "published"%}
                <a class="govuk-link" href="/rfi/type">
            Change<span class="govuk-visually-hidden">RFI type</span>
                </a>
              {% endif %}
            </dd>
          </div>-->



            <div class="ccs-summary-list-heading">
              <strong> Build your Rfi <br><br></strong>
            </div>

          {# {% if ccs_rfi_type == 'all_online' %}

            <div class="ccs-summary-list-heading">
              <strong> Buying organisation (optional)</strong>
            </div>

          {% else %} #}

          {#rfi_data#}
          {%for item in rfi_data%}
              {% if (item.title=="Who the buying organization is") or (item.title=="Who the buying organization is (Optional)") %}
                 <div class="govuk-summary-list__row">
              <dt class="govuk-summary-list__key">
                <strong>The buying organisation (optional)</strong>
                <br/><br/>
                {%for i in item.answer%}
                {{i.question}}
                <br/>
                <br/>
                {% endfor %}
               </dt>
                {% if data['rfi_offline_document'] | length > 0 %}
                <dd class="govuk-summary-list__value">
                  data['rfi_offline_document']
                 </dd>
    
              {% else %}
                <dd class="govuk-summary-list__value">
                </br>
                </br>
                  {% for i in item.answer %}
                  
                    {% if i.values | length > 0 %}
                      {% for answer in i.values%}
                        {{answer.value}}
                          <br/><br/>
                            {%endfor%}
                            {%else%}
                            <p class="govuk-body-s">You have not answered this question<p>
                                </dd>
                                {%endif%}
                              {% endfor %}
        
              <dd class="govuk-summary-list__actions">
                
                </br>
                </br>
                  {% for i in item.answer %}
                      {% for answer in i.values%}
                        {% if eventStatus != "published"%}
                                <a class="govuk-link" href="/rfi/questions?agreement_id={{agreement_id}}&proc_id={{proc_id}}&event_id={{event_id}}&id={{item.criterian}}&group_id={{item.id}}">
            Change<span class="govuk-visually-hidden">RFI type</span>
                                </a>
                                <br/><br/>
                              {% endif %}
                            {% endfor %}
                            {% endfor %}
                            {% endif %}
                            </dd>
                          </div>
                          
                        



                {% else %}
                <div class="govuk-summary-list__row">
              <dt class="govuk-summary-list__key">
                {% if item.mandatory == false %}
              {{item.title}} (optional)
              {% else %}
              {{item.title}} 
              {% endif %}
              </dt>
              {% if data['rfi_offline_document'] | length > 0 %}
                <dd class="govuk-summary-list__value">
          data['rfi_offline_document']
        </dd>
              {% else %}
                <dd class="govuk-summary-list__value">
  
                  {% for i in item.answer %}
                  
                    {% if i.values | length > 0 %}
                      {% for answer in i.values%}
                        <p class="govuk-body-s">{{answer.value}}
                          <p>
                            <p class="govuk-body-s">{{answer.text | safe}}
                            </p>
                            <br/>
                            {%endfor%}
                            {%else%}
                            <p class="govuk-body-s">You have not answered this question<p>
                                {%endif%}
                                {%endfor%}
                              </dd>
                            {% endif %}
                            <dd class="govuk-summary-list__actions">
                              {% if eventStatus != "published"%}
                                <a class="govuk-link" href="/rfi/questions?agreement_id={{agreement_id}}&proc_id={{proc_id}}&event_id={{event_id}}&id={{item.criterian}}&group_id={{item.id}}">
            Change<span class="govuk-visually-hidden">RFI type</span>
                                </a>
                              {% endif %}
                            </dd>
                          
                          </div>
                          {% endif %}
                        
                        {% endfor %}
                       </dl> 
        

                        <div>
              <h2 class="govuk-heading-m"> 3. Review and publish your RfI </h2>
                        <dl class="govuk-summary-list">

<div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
        </dt>
              <dd class="govuk-summary-list__value">
              </dd>
            <dd class="govuk-summary-list__actions">
              
            </dd>
          </div>

                          <div class="govuk-summary-list__row">
                            <dt class="govuk-summary-list__key">
          Upload documents
        </dt>
                            {% if documents | length > 0 %}
                              <dd class="govuk-summary-list__value">
                                <ul class="govuk-list govuk-list--none">
                                  {% for document in documents%}
                                    <li>
                                      <span>Uploaded file: &nbsp;</span>
                                      {#<a href="/rfi/upload-doc">#}
                                        {{ document }}
                                      {#</a>#}
                                    </li>

                                    {%endfor%}
                                  </ul>
                                </dd>
                                {%else%}
                                <dd class="govuk-summary-list__value">
                                  <p class="govuk-body-s"> You have not uploaded any document </p>
                                </dd>
                              {% endif %}

                              <dd class="govuk-summary-list__actions">
                                {% if eventStatus != "published"%}
                                {#{% if disableLink==true %}
                                  <a class="govuk-link" href="#">
            Change<span class="govuk-visually-hidden">rfi additional link and documents</span>
                                  </a>
                                  {% else %}#}
                                  <a class="govuk-link" href="{{ '#' if disableLink else '/rfi/upload-doc' }}">
            Change<span class="govuk-visually-hidden">rfi additional link and documents</span>
                                  </a>
                                  {#{% endif %}#}
                                {% endif %}
                              </dd>
                            </div>



<div class="govuk-summary-list__row">
                            <dt class="govuk-summary-list__key">
          See the suppliers who will receive your RfI
        </dt>
                          
                                <dd class="govuk-summary-list__value">
                                  <p class="govuk-body-s">{{suppliers_list.length}} &nbsp suppliers selected</p>
                                </dd>
                              

                              <dd class="govuk-summary-list__actions">
                                {% if eventStatus != "published"%}
                                  <a class="govuk-link" href="/rfi/suppliers">
                                    View<span class="govuk-visually-hidden">rfi additional link and documents</span>
                                  </a>
                                {% endif %}
                              </dd>
                            </div>

            
            <dt>
            <div class="ccs-summary-list-heading">
              <strong> Your Rfi timeline <br><br></strong>
            </div>
            </dt>
            <dd class="govuk-summary-list__value no-borders">
                </dd>
            <dd class="govuk-summary-list__actions no-borders">
                                    {% if eventStatus != "published"%}
                                      <a class="govuk-link" href="/rfi/response-date">
           Change <span class="govuk-visually-hidden"> Your RFI timeline</span>
                                      </a>
                                    {% endif %}
                                  </dd>
                                  
                            {% for dates in rfi_keydates.answer%}
                              <div class="govuk-summary-list__row no-borders">
                                <dt class="govuk-summary-list__row no borders">
                                  {{dates.question}}
                                </dt>
                                <dd class="govuk-summary-list__value no-borders">
                                  {%for value in dates.values%}
                                    <p class="govuk-body-s">
                                      {{value.value}}</p>
                                    {%endfor%}
                                  </dd>
                                </div>
                                {%endfor%}
                              
                            
                          
            
            
            <dt class="govuk-summary-list__key">
            </dt>
            <dd class="govuk-summary-list__value">
            </dd>
            <dd class="govuk-summary-list__actions">
            </dd>
            </dl>
            </div>
            </div>
            
            
                          <div class="govuk-grid-row">
                            <div class="govuk-grid-column-full govuk-grid-column-two-thirds-from-desktop">
                              <p class="govuk-body">
                                <h2 class="govuk-heading-m"> Publish your RfI</h2>
                              </p>
                              <p class="govuk-body">
      After publishing this RfI, you can cancel, amend, clarify, add to, or withdraw all or part of it, at any time.
    </p>

                              <p class="govuk-body">
      The document sent to suppliers will also include a number of best practice statements from your organisation.
        </p>
                              <br><br>

                              {{ CCSWarningText({
    text: "By publishing this Request for Information (RfI) to all the suppliers you selected, you are stating that, to the best of your knowledge, the information you have provided is correct.",
    iconFallbackText: "Warning"
    }) }}

                              
                              <br><br>
                            </div>
                          </div>
                          {% if eventStatus != "published"%}
                            <form id="ccs_rfi_publish_form" name="ccs_rfi_publish_form" class="form ccs_rfi_publish_form"
      action="/rfi/review" method="post">
                              {{ csrfProtection(csrf) }}
                              {{ CCSCheckboxes({
      idPrefix: "rfi_publish_confirmation",
      name: "rfi_publish_confirmation",
      items: [
      {
      "value": 1,
      html: "<label><strong>By checking this box I confirm the statements above.</strong></label>",
      Checked: ""
      }
      ]
      }) }}
                                <div class="govuk-button-group">
                                  {{ CCSButton({
        attributes: {
        id: "rfi_btn_publish_now"
        },
        text: "Publish and continue"
        }) }}
                                  <a href="/rfi/rfi-tasklist?agreement_id={{agreement_id}}&proc_id={{proc_id}}&event_id={{event_id}}" class="govuk-link govuk-link--no-visited-state">Return to Do pre-market engagement  </a>
                                </div>
                                {{ CCSInput({
      id: "finished_pre_engage",
      name: "finished_pre_engage",
      type: "hidden",
      value: "true"
      }) }}

                              </form>
                            {% endif %}
                          </div>
                        </div>

                      </main>

                    {% endblock %}
