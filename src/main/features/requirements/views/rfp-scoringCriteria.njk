{% extends "template.njk" %}
{% from "components/releatedContent.njk" import CCSReleatedContent %}
{% from "macros/csrf.njk" import csrfProtection %}
{% set title =  rfpTitle + '- Create a Request for Information (rfp)' %}

{% block breadCrumb %}
{{ CCSBreadcrumbs({
    items: [
     {
        text: "Your dashboard",
        href: "/dashboard"
      },
      {
        text: "Choose a commercial agreement",
        href: "/projects/choose-agreement"
      },
      {
            text: "Procurement overview",
            href: "/projects/create-or-choose"
        },
        {
          text: "Write and publish your requirements",
          href: "/rfp/task-list"
        },        
        {
          text: bcTitleText
        }
    ]
  }) }}

{% endblock %}

{% block content %}

<div class="backdrop-rfp-scoring" id="rfpscoringpopup">
  <div class="messagepop pop" role="dialog" aria-labelledby="navigationDialog" style="display: block;">
    <div class="pop_logo govuk-grid-column-full">
      <hidden id="redirect-dialog" class="govuk-visually-hidden"></hidden>
      <p class="pop_logo_image govuk-grid-column-one-half" <a="" href="#">
        <img class="popup_image" src="/assets/images/CCS_WHITE_SML_AW.png" alt="Go to the CCS homepage">
      
      </p>
      <p class="govuk-!-text-align-right govuk-grid-column-one-half dialog-close-rfp-scoring govuk-!-padding-top-6">
      <a href="#" class="dialog-close-rfp-scoring nav-list__link_secondary">X</a></p>
    </div>
    <div class="govuk-grid-column-full">
      <h1 id="dialog-title">Selecting this option will replace what you've entered so far and cannot be undone<p></p>
      <p id="dialog-description"><b>The details you've entered below will be replaced with the CCS default scoring criteria.</br></br>This action cannot be undone</b></p>
      <div class="govuk-button-group">
        <button id="redirect-button-rfp-scoring" class="button dialog-button govuk-button" name="Continue">Continue</button>
        <a href="#" class="dialog-close-rfp-scoring govuk-link govuk-link--no-visited-state">Cancel</a>
      </div>
    </h1></div>
  </div>
</div>

  <main class="govuk-main-wrapper govuk-main-wrapper--auto-spacing" id="main-content" role="main">

    {% if(emptyFieldError)%}
      {{ CCSErrorSummary({
          titleText: "There is a problem",
          errorList: errorText
      }) }}
    {%endif %}
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">
        <h1 id="page-heading" class="govuk-heading-xl">
         <strong> {{rfpTitle}}</strong>
        </h1>
      </div>
    </div>
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        {% include "includes/project_header.njk" %}
       {%if (form_name === 'ccs_rfp_scoring_criteria')%}
              <div class="govuk-grid-column-two-thirds">
                <p class="govuk-body">You must tell suppliers what scoring criteria you are using to evaluate their responses.You must also use this scoring criteria for all suppliers,to make sure you have evaluated them fairly.</p>
                 <p class="govuk-body">You can select one of the two scoring criteria below or use one of the existingscoring criteria to create your own.</p>

              </div>
              
          {%endif%}
          <form id="{{form_name}}"  name="{{form_name}}" class="form {{form_name}} rfp_form" action="/rfp/set-scoring-criteria?agreement_id={{agreement_id}}&proc_id={{proc_id}}&event_id={{event_id}}&id={{criterian_id}}&group_id={{group_id}}&section={{section}}" method="post">
          {{ csrfProtection(csrf) }}
          <input type="hidden" agreementEndDate="{{agreementEndDate}}" id="rpf_section_3_aggrimentEndDate">
           {%if(prompt.length>0) and (form_name !== 'ccs_rfp_scoring_criteria') %}
             <p class="govuk-body">{{prompt[0] | safe}}</p>
             {%endif%}
             {%if(prompt.length>1)%}
              <p class="govuk-body">{{prompt[1] | safe}}</p>
             {%endif%}
            

              {% macro recurseRequirements(requirement,form_name,index = 0) -%}
              {%if (requirement.nonOCDS.childern.length > 0)%}
               {{CCSQUESTIONS(organizationName,requirement,form_name, index)}}
               {{recurseRequirements(requirement.nonOCDS.childern[0],form_name, index)}}
              {%else%}
               {{CCSQUESTIONS(organizationName,requirement,form_name, index)}}
              {%endif%}
              {%- endmacro %}
              

              {%if (form_name === 'rfp_multianswer_question_form')%}
                <div class="ccs-page-section">
                  <p class="govuk-body">
                    <h2>
                      <span id="questionsCount">{{questionsCount}}</span>
                      {{shortTitle}} questions entered so far</h2>
                    <h2> Total for the {{shortTitle}} group: <span id="totalPercentage">{{totalPercentage    }}</span> of 100%</h2>
                  </p>
                </div>
                {% set numberWord = [
                  'Zero',
                  'first',
                  'second',
                  ' third',
                  ' fourth',
                  ' fifth',
                  ' sixth',
                  ' seventh',
                  ' eight',
                  ' ninth',
                  ' tenth'
                ] %}
                {% for i in range(1, 11) -%}
                  <div id="fc_question_{{i}}" class="ccs-page-section {{'additional' if i>1 }}">
                    <label class="govuk-label govuk-label govuk-label--m" for="fc_question_{{i}}" >Enter your {{numberWord[i]}}
                      {{shortTitle}} question <a href="javascript.void()" id="del_fc_question_{{i}}" class='del govuk-link govuk-link--no-visited-state ccs-dynaform-hidden' title='delete'> X </a>
                    </label>
                  </br>
                  {% for requirement in data %}
                    {{recurseRequirements(requirement,form_name,i)}}
                  {% endfor %}
                </div>
                {%endfor%}
                {% if(section==='5') and (form_name === 'rfp_multianswer_question_form')%}
                <div class="ccs-page-section">
                  {{ CCSButton({
                        text: "Add another question",
                        type:"button",
                        classes:"add-another-btn"                 
                      })}}
                </div>
                {%elseif(section !=='5')%}
                <div class="ccs-page-section">
                  {{ CCSButton({
                        text: "Add another question",
                        type:"button",
                        classes:"add-another-btn"                 
                      })}}
                </div>
                {%endif%}
              {%elif (form_name !== 'ccs_rfp_acronyms_form')%}
                {% for requirement in data %}
                  {{recurseRequirements(requirement,form_name,loop.index)}}
                {% endfor %}

              {%endif%}

                {% if (form_name === 'read_me') %}
                  {{ CCSInput({
              id: "rfp_read_me",
              name: "rfp_read_me",
              type: "hidden",
              value: true
            }) }}
                {% endif %}

                {{ CCSInput({
                    id: "rfp_build_started",
                    name: "rfp_build_started",
                    type: "hidden",
                    value: true
                  })
                }}

                <div class="govuk-button-group">

                  {% if (form_name === 'read_me') %}
                    {{ CCSButton({
                          text: "Continue",
                          classes:"save-button"
                        }) }}
                  {% else %}
                    {{ CCSButton({
                          text: "Save and continue",
                          classes:"save-button"
                        }) }}
                  {% endif %}
                  <a href="/rfp/task-list" class="govuk-link govuk-link--no-visited-state">Return to write and publish your requirements</a>
                </div>
              </form>
            </div>
            <div class="govuk-grid-row">
              <div class="govuk-grid-column-one-third">
                {{ CCSReleatedContent(releatedContent) }}
              </div>
            </div>
          </form>
        </div>

      </div>
    </main>
  {% endblock %}