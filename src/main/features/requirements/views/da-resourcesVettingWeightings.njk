{% extends "template.njk" %}
{% from "components/releatedContent.njk" import CCSReleatedContent %}
{% from "components/dialog/macro.njk" import CCSDialog %}

{% block breadCrumb %}
  {{ CCSBreadcrumbs({
    items: breadCrumbs
  }) }}
{% endblock %}

{% block content %}
  <main class="govuk-main-wrapper govuk-main-wrapper--auto-spacing" id="main-content" role="main">
{{ CCSDialog({
  title:'This action cannot be undone, please confirm that you want to progress.',
  description:'This action will revert the form to its original stated.',
  redirect:'#',
  type:'vetting'
}) }}
    {% if(isError)%}
      {{ CCSErrorSummary({
          titleText: "There is a problem",
          errorList: errorText
      }) }}
    {%endif %}
 <div class="govuk-grid-row">
    <h1 class="govuk-heading-xl">
        {{title}}
    </h1>
    <div class="govuk-grid-column-full govuk-grid-column-two-thirds-from-desktop">
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">

        {% include "includes/project_header.njk" %}
      </div>
    </div>
    <div id="error_summary_resources">
    

   
    <div class="ccs-page-section">
      <div class="sub-section">
       <p class="govuk-body">{{data.addedResources}} resources added</p>
        <p class="govuk-body">{{data.totalStaff}} of 100% total weighting for number of staff</p>
        <p class="govuk-body">{{data.totalVetting}} of 100% total weighting for related vetting requirement</p>
      </div>
       <div class="sub-section"><a href="#" class="del govuk-link govuk-link--no-visited-state vetting-popup" title="delete">Clear form</a></div>
    </div>
        <form id="ccs_ca_menu_tabs_form_later_vetting" name="ccs_ca_menu_tabs_form" class="form ccs_ca_menu_tabs_form" action="/da/resources-vetting-weightings" method="POST">
     <input type="hidden" name="_csrf" value="{{token}}">
    <section class="ons-page__container ons-container">
        <div id="vertical_tab_nav" class="ons-grid ons-js-toc-container">
            <div class="ons-grid__col ons-grid__col--sticky@m ons-col-4@m">
                {{-
                    onsTableOfContents({
                        "title": null,
                        "ariaLabel": 'Sections in this page',
                        "itemsList": TableItems
                    })
                }}
            </div>
            <div class="ons-grid__col ons-col-7@m ons-push-1@m">

            {% for tr in designations %}

              <article id="section">
                    <h2 class="govuk-heading-xl govuk-!-font-weight-bold" >{{tr['Parent']}}</h2>
                    <h4> {{tr['Parent']}} description </h4>
       
                     {% for subItems in tr.category %}
                     {% set newID = subItems.ParentName.split(" ").join("")%}
                     <div class="govuk-!-margin-top-5">
                     <h2 class="govuk-heading-m">{{subItems.ParentName}}</h2>
                     <p> [DDAT Family description] </p>
                     <div class="govuk-!-margin-top-9">
                      <p> Weighting for number of staff </p>
                        {{ CCSInput({
                          label: {
                            text: ""
                          },
                          classes: "govuk-input--width-2 weight_staff_class",
                          id: "weight_staff_"+loop.index+newID,
                          name: "weight_staff",
                          suffix: {
                            text: "%"
                          },
                          spellcheck: false
                        }) }}
                       <p> Weighting for related vetting requirement </p>

                         {{ CCSInput({
                          label: {
                            text: ""
                          },
                          classes: "govuk-input--width-2",
                          id: "weight_vetting_"+loop.index+newID,
                          name: "weight_vetting",
                          suffix: {
                            text: "%"
                          },
                          spellcheck: false
                        }) }}
                           {{ CCSInput({
                                    id: "weight_vetting_whole_group_"+loop.index+newID,
                                    name: "weigthage_group_name",
                                    type: "hidden",
                                    value: subItems.ParentName
                                  }) }}
                     </div>

                      <div class="govuk-!-margin-top-9">
                      <p> Add quantity for the roles </p>
                      <div>
                         {% for subNestedItems in subItems.designations %}
                          {% set newsubID = subItems.ParentName.split(" ").join("")%}
                            <span  class="sfia-roles">  
                         {{ CCSInput({
                          label: {
                            text: ""
                          },
                          classes: "govuk-input--width-2 weight_vetting_class",
                          id: "weight_vetting_"+loop.index+newsubID,
                          name: "SFIA_weightage",
                          suffix: {
                            text: subNestedItems['SFIA_name']
                          },
                          spellcheck: false
                        }) }}
</span>
                         {{ CCSInput({
                                    id: "weight_vetting_whole_group_"+loop.index+newID,
                                    name: "requirement_Id_SFIA_weightage",
                                    type: "hidden",
                                    value: subNestedItems['requirement-id']
                                  }) }}



                         {%endfor%}
                       <div>
                       <hr>
                     {% endfor %}
                </article>

              
            {% endfor %}
            </div>
        </div>
    </section>
      <div class="govuk-button-group">
        {{ CCSButton({
              text: "Save and continue",
              classes:"save-button"
            })
        }}
        <a href="{{backJump.href}}" class="govuk-link govuk-link--no-visited-state">{{backJump.title}}</a>
      </div>
      </form>
       </div>
      </div>
    <div class="govuk-grid-column-one-third">
      {{ CCSReleatedContent(releatedContent) }}
    </div>
    </div>

    </div>
  </main>
        {% endblock %}